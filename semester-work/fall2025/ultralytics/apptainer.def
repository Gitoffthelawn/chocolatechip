Bootstrap: docker
From: ultralytics/ultralytics:latest

%environment
    export DEBIAN_FRONTEND=noninteractive
    export PATH="/usr/local/bin:${PATH}"
    export PYTHONPATH="/opt/app/src:${PYTHONPATH}"

%files
    src   /opt/app/

%post
    set -eux

    apt-get update
    apt-get install -y --no-install-recommends fio
    rm -rf /var/lib/apt/lists/*

    python -m pip install --no-cache-dir --upgrade pip
    python -m pip install --no-cache-dir \
        pycocotools \
        imagesize \
        cloudmesh-common \
        git+https://github.com/cloudmesh/cloudmesh-gpu.git

    mkdir -p /workspace /outputs /ultralytics/.cache
    chmod -R a+rX /workspace /outputs /ultralytics
    chmod -R a+rwX /workspace /outputs /ultralytics/.cache

%runscript
    exec bash -lc "python -u -m chocolatechip.model_training.train --profile LeatherUltra"
